<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blacklink Trust 1.2</title>

  <!-- NOVA base layer -->
  <link rel="stylesheet" href="trust+nova.css" />
</head>
<!-->
Blacklink Trust 1.2
NOVA Alpha 1.0
Â©2025 Blacklink Education, Inc.
</!-->

<body>
  <!-- â”€â”€â”€â”€â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header>
    <div class="logo" style="display:flex;align-items:center;gap:10px;">
      <img src="trust-logo.svg" alt="Blacklink Trust logo" width="40" height="40" />
      <h3>Blacklink Trust</h3>
    </div>

    <div class="nav-right">
      <button id="theme-toggle" aria-pressed="false" aria-label="Toggle dark/light theme">ðŸŒ™</button>
      <button id="account-btn">Login</button>
    </div>
  </header>

  <!-- â”€â”€â”€â”€â”€â”€â”€ MAIN CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <main class="container trust-extension">

    <h2>Sources</h2>
    <p>The source for finding sources.</p>

    <!-- â”€â”€ Toolbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="toolbar">
      <input
        type="search"
        id="search-input"
        placeholder="Search sourcesâ€¦"
        aria-label="Search sources"
        autocomplete="off"
        disabled
      />

      <div class="filter-sort-row">
        <div class="filter-container" role="group" aria-label="Filter sources by trust level">
          <button type="button" class="active" data-filter="all" disabled>All</button>
          <button type="button" data-filter="trusted" disabled>Trusted</button>
          <button type="button" data-filter="mostly-trusted" disabled>Mostly Trusted</button>
          <button type="button" data-filter="not-trusted" disabled>Not Trusted</button>
        </div>

        <select id="sort-select" aria-label="Sort sources" disabled>
          <option value="default">Sort By</option>
          <option value="trust-desc">Trust Level â†“</option>
          <option value="trust-asc">Trust Level â†‘</option>
          <option value="name-asc">Name A â†’ Z</option>
          <option value="name-desc">Name Z â†’ A</option>
          <option value="category-asc">Category A â†’ Z</option>
          <option value="category-desc">Category Z â†’ A</option>
        </select>
      </div>
    </div>

    <!-- â”€â”€ Resource list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="resource-list" aria-live="polite" aria-relevant="additions removals" style="min-height: 150px;">

      <p id="loading-msg">Loading sourcesâ€¦</p>

    </div><!-- /#resource-list -->
  </main>

  <!-- â”€â”€â”€â”€â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <footer style="text-align:center;padding:2rem;color:#666;user-select:none;">
    Â© 2025 Blacklink Education, Inc. Â· Licensed under CC BY-NC-SA 4.0
  </footer>

  <!-- â”€â”€â”€â”€â”€â”€â”€ SCRIPTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <script>
    /* ================================
       Utility helpers
    ==================================*/
    function qs(sel, ctx = document)  { return ctx.querySelector(sel); }
    function qsa(sel, ctx = document) { return Array.from(ctx.querySelectorAll(sel)); }

    /* ================================
       Blacklink Account Support
    ==================================*/
    const accountBtn = qs("#account-btn");
    const searchInput = qs("#search-input");
    const filterButtons = qsa(".filter-container button");
    const sortSelect = qs("#sort-select");

    // Simple mock account system - replace with real API calls
    function login() {
      // Simple prompt login - replace with your real auth UI/API
      const username = prompt("Enter your Blacklink username:");
      if (!username) return;

      // Fake async login
      setTimeout(() => {
        sessionStorage.setItem("bl_user", username);
        updateAccountUI();
        loadSources();
      }, 500);
    }

    function logout() {
      sessionStorage.removeItem("bl_user");
      updateAccountUI();
      clearSources();
    }

    function updateAccountUI() {
      const user = sessionStorage.getItem("bl_user");
      if (user) {
        accountBtn.textContent = `Logout (${user})`;
        accountBtn.onclick = logout;
        // Enable search/filter/sort
        searchInput.disabled = false;
        filterButtons.forEach(b => b.disabled = false);
        sortSelect.disabled = false;
      } else {
        accountBtn.textContent = "Login";
        accountBtn.onclick = login;
        searchInput.disabled = true;
        filterButtons.forEach(b => b.disabled = true);
        sortSelect.disabled = true;
      }
    }

    /* ================================
       Render source HTML from JSON
    ==================================*/
    function createSourceElement(src) {
      /*
       src = {
         name, trust, category, logo: {src, alt}, description, url, detailsUrl
       }
      */
      const div = document.createElement("div");
      div.className = "resource-item";
      div.dataset.trust = src.trust;
      div.dataset.name = src.name;
      div.dataset.category = src.category;
      div.setAttribute("tabindex", "0");
      div.setAttribute("role", "button");
      div.setAttribute("aria-expanded", "false");

      div.innerHTML = `
        <div class="top-row" style="display:flex;justify-content:space-between;align-items:center;gap:1rem;">
          <div class="name" style="display:flex;align-items:center;gap:8px;">
            <img src="${src.logo.src}" alt="${src.logo.alt}" class="source-logo" loading="lazy" />
            <strong>${src.name}</strong>
            <span class="source-tag" aria-label="Category: ${src.category}">${src.category}</span>
          </div>
          <div class="right-controls" style="display:flex;align-items:center;gap:8px;">
            <a href="${src.url}" target="_blank" rel="noopener" aria-label="Visit ${src.name} website">
              <button type="button">Visit</button>
            </a>
            <a href="${src.detailsUrl}" target="_blank" rel="noopener" aria-label="Expand ${src.name} details">
              <button type="button">Expand</button>
            </a>
            <button type="button" class="copy-link-btn" aria-label="Copy ${src.name} link">ðŸ“‹</button>
            <div class="trust-circle" title="${src.trust.charAt(0).toUpperCase() + src.trust.slice(1).replace('-', ' ')} source" aria-label="${src.trust.charAt(0).toUpperCase() + src.trust.slice(1).replace('-', ' ')} source"></div>
          </div>
        </div>
        <div class="details" aria-hidden="true" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease;">
          <p>${src.description}</p>
        </div>
      `;

      // Add expand/collapse behavior
      const details = div.querySelector(".details");
      div.addEventListener("click", e => {
        if (e.target.closest("button,a")) return; // ignore buttons/links
        const expanded = div.classList.toggle("expanded");
        div.setAttribute("aria-expanded", expanded);
        details.setAttribute("aria-hidden", !expanded);
        details.style.maxHeight = expanded ? details.scrollHeight + "px" : "0";
      });
      div.addEventListener("keydown", e => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          div.click();
        }
      });

      // Copy link button behavior
      const copyBtn = div.querySelector(".copy-link-btn");
      copyBtn.addEventListener("click", e => {
        e.stopPropagation();
        navigator.clipboard.writeText(src.url).then(() => {
          copyBtn.textContent = "âœ…";
          setTimeout(() => (copyBtn.textContent = "ðŸ“‹"), 1500);
        });
      });

      return div;
    }

    /* ================================
       Load sources from JSON
    ==================================*/
    async function loadSources() {
      const container = qs("#resource-list");
      container.innerHTML = '<p id="loading-msg">Loading sourcesâ€¦</p>';

      try {
        const response = await fetch("https://trust.blacklink.net/sources/data.json", {cache: "no-store"});
        if (!response.ok) throw new Error(`HTTP error ${response.status}`);

        const sources = await response.json();

        if (!Array.isArray(sources) || sources.length === 0) {
          container.innerHTML = "<p>No sources found.</p>";
          return;
        }

        // Clear and enable toolbar
        container.innerHTML = "";
        searchInput.disabled = false;
        filterButtons.forEach(b => b.disabled = false);
        sortSelect.disabled = false;

        sources.forEach(src => {
          const elem = createSourceElement(src);
          container.appendChild(elem);
        });

        attachUIListeners();

      } catch (err) {
        container.innerHTML = `<p style="color: red;">Failed to load sources: ${err.message}</p>`;
      }
    }

    /* ================================
       Clear sources (e.g. on logout)
    ==================================*/
    function clearSources() {
      const container = qs("#resource-list");
      container.innerHTML = '<p id="loading-msg">Please log in to view sources.</p>';
      searchInput.value = "";
      searchInput.disabled = true;
      filterButtons.forEach(b => b.disabled = true);
      sortSelect.disabled = true;
    }

    /* ================================
       Attach UI event listeners for filter, search, sort
    ==================================*/
    function attachUIListeners() {
      // Filter buttons
      filterButtons.forEach(btn => {
        btn.onclick = () => {
          filterButtons.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          filterSources(btn.dataset.filter);
        };
      });

      // Search input
      searchInput.oninput = () => {
        const query = searchInput.value.toLowerCase();
        qsa(".resource-item").forEach(item => {
          const name = item.dataset.name.toLowerCase();
          item.style.display = name.includes(query) ? "flex" : "none";
        });
      };

      // Sort select
      sortSelect.onchange = e => sortSources(e.target.value);
    }

    /* ================================
       Filtering sources
    ==================================*/
    function filterSources(level) {
      qsa(".resource-item").forEach(item => {
        item.style.display =
          level === "all" || item.dataset.trust === level ? "flex" : "none";
      });
    }

    /* ================================
       Sorting sources
    ==================================*/
    function sortSources(mode) {
      const orderDesc = ["trusted", "mostly-trusted", "not-trusted"];
      const orderAsc  = [...orderDesc].reverse();
      const container = qs("#resource-list");
      const items = qsa(".resource-item", container);

      const sorted = items.sort((a, b) => {
        switch (mode) {
          case "name-asc":        return a.dataset.name.localeCompare(b.dataset.name);
          case "name-desc":       return b.dataset.name.localeCompare(a.dataset.name);
          case "trust-desc":      return orderDesc.indexOf(a.dataset.trust) - orderDesc.indexOf(b.dataset.trust);
          case "trust-asc":       return orderAsc.indexOf(a.dataset.trust)  - orderAsc.indexOf(b.dataset.trust);
          case "category-asc":    return a.dataset.category.localeCompare(b.dataset.category);
          case "category-desc":   return b.dataset.category.localeCompare(a.dataset.category);
          default:                return 0;
        }
      });

      sorted.forEach(item => container.appendChild(item));
    }

    /* ================================
       Theme toggle
    ==================================*/
    const themeToggle = qs("#theme-toggle");
    themeToggle.addEventListener("click", () => {
      const light = document.body.classList.toggle("light");
      themeToggle.setAttribute("aria-pressed", light);
      themeToggle.textContent = light ? "ðŸŒž" : "ðŸŒ™";
    });

    /* ================================
       Initial setup
    ==================================*/
    updateAccountUI();

    if (sessionStorage.getItem("bl_user")) {
      loadSources();
    } else {
      clearSources();
    }

    /* ================================
       Account placeholder fallback
    ==================================*/
    function openAccount() {
      alert("Blacklink Account Management System is offline. Try again later.");
    }
  </script>
</body>
</html>